
---

## 使用文档

> **说明：** 本工具支持提取指定后缀的文件，支持大小写匹配设置及多种哈希算法生成文件名前缀，`--extension` 参数为必选项。

### 1. 概述

本工具用于从指定源目录中提取符合条件的文件，并将其复制或移动到指定的目标目录。支持以下功能：

- **自定义文件后缀：** 通过必选参数指定待提取文件的后缀（如 `.exe`, `.txt`）。
- **后缀大小写匹配控制：** 可选择是否强制匹配文件后缀大小写。
- **复制/移动模式：** 根据参数选择复制或移动文件。
- **哈希前缀：** 根据指定哈希算法生成文件前缀，自动处理文件名冲突（前缀冲突时逐步增加位数直至唯一）。

### 2. 功能特点

- **文件后缀自定义**  
  通过必选参数 `--extension` 指定目标文件后缀，需包含点号。

- **大小写匹配控制**  
  默认忽略后缀大小写，可通过 `--case-sensitive` 参数强制区分。

- **多种哈希算法支持**  
  支持 CRC32、MD5、SHA256、SHA384、SHA512、MD2、MD4，用于生成文件名前缀。

- **自动重命名策略**  
  文件名前缀冲突时，程序逐步增加哈希位数直至生成唯一文件名；如冲突依旧则自动添加数字后缀。

### 3. 环境要求

- Python 3.x
- 标准库模块：`os`、`shutil`、`argparse`、`sys`、`pathlib`、`zlib`、`hashlib`

### 4. 命令行参数

| 参数名称  | 短选项  | 长选项                | 类型   | 默认值    | 描述                                                               |
|-------|------|--------------------|------|--------|------------------------------------------------------------------|
| 源目录   | `-S` | `--source`         | str  | 当前工作目录 | 指定文件源目录                                                          |
| 目标目录  | —    | (positional)       | str  | N/A    | 指定文件提取的目标目录                                                      |
| 移动模式  | `-M` | `--move`           | flag | False  | 启用移动模式，若不指定则默认复制文件                                               |
| 前缀位数  | `-P` | `--prefix-length`  | int  | 0      | 前缀位数，非 0 表示启用文件哈希前缀（如：`-P 5` 表示初始取 5 位哈希，冲突时逐步增加）                |
| 文件后缀  | `-E` | `--extension`      | str  | 无默认值   | 指定待提取文件的后缀（如：.exe, .txt），**必选**，注意需包含点号                          |
| 大小写匹配 | `-C` | `--case-sensitive` | flag | False  | 强制匹配后缀大小写，默认忽略（例如 `.HEIC` 与 `.heic` 视为相同）                        |
| 哈希算法  | `-A` | `--algorithm`      | str  | SHA512 | 选择哈希算法，用于生成文件名前缀，支持：CRC32, MD2, MD4, MD5, SHA256, SHA384, SHA512 |

### 5. 使用示例

#### 示例 1：复制指定后缀 (.heic) 文件到目标目录 `./output`

```bash
python script.py ./output -E .heic
```

#### 示例 2：移动 `/path/to/source` 目录下所有 `.exe` 文件（强制区分大小写）到 `/path/to/target`

```bash
python script.py /path/to/target -S /path/to/source -M -E .exe -C
```

#### 示例 3：复制文件，并使用 5 位 MD5 哈希前缀（冲突时逐步增加）

```bash
python script.py /path/to/target -E .txt -P 5 -A MD5
```

#### 示例 4：移动文件，并使用 SHA256 哈希前缀

```bash
python script.py /path/to/target -S /path/to/source -M -E .png -P 5 -A SHA256
```

### 6. 代码结构说明

- **get_unique_path**  
  检查目标目录中是否存在同名文件，若存在则自动添加数字后缀生成唯一路径。

- **compute_file_hash**  
  根据指定哈希算法计算文件哈希值：
    - 若算法为 CRC32，则使用 zlib 计算；
    - 否则通过 hashlib.new() 调用对应算法计算文件摘要。

- **main**  
  解析命令行参数，遍历源目录中所有文件，筛选符合指定后缀（支持大小写匹配设置）的文件，根据参数选择复制或移动，并通过哈希前缀及自动重命名策略确保目标文件名唯一。

### 7. 注意事项

- 请确保源目录存在且包含符合指定后缀的文件。
- 目标目录不存在时，程序会自动创建。
- 必选参数 `--extension` 必须指定待提取文件的后缀，且需包含点号。
- 部分哈希算法（如 MD2、MD4）可能依赖系统 OpenSSL 支持，不同平台支持情况可能存在差异。

### 8. 更新记录

| 日期         | 版本  | 说明                                   |
|------------|-----|--------------------------------------|
| 2025-02-16 | 初始版 | 支持复制/移动模式、文件后缀筛选及大小写匹配、哈希前缀及自动重命名功能。 |
| 2025-02-16 | 更新版 | 新增文件后缀自定义（必选）、强制大小写匹配选项以及多种哈希算法选择。   |

### 9. 联系与反馈

如有问题或建议，请及时联系开发者反馈。

---
